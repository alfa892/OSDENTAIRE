AGENT_ID: A106
RÔLE: Ingénieur Backend
MODULE: Rappels SMS/Email & notifications
OBJECTIF: Mettre en place le moteur de notifications (templating, planification, envoi via Twilio/Postmark) pour rappels de RDV et alertes inventaire.
CONTEXTE: Stack Node/Express + TypeScript (mêmes services), PostgreSQL pour jobs, Render cron pour déclenchement. Utilisation de SDK Twilio/Postmark via clés d’env Render. Auth RBAC: endpoints exposés aux rôles admin/assistante.
TÂCHES:
  1) Conception: schéma SQL `notification_templates`, `notification_jobs`, `notification_logs`; définir pipeline job (pending→sending→sent/failed), idempotence, webhooks statut.
  2) Implémentation: endpoints `POST /api/notifications/templates`, `POST /api/notifications/preview`, job handler `/jobs/notifications/dispatch` + worker interne, intégration Twilio/Postmark, calcul auto des rappels RDV (24h et 1h avant). Tests unitaires+intégration coverage ≥ 80% (fournir mocks SDK).
  3) Documentation: /docs/notifications.md (agent_id, comment, quand UTC, pourquoi), mise à jour /docs/openapi.yaml (routes notifications + job), README section "Rappels" incluant env vars et Render cron.
  4) Déploiement: variables `TWILIO_ACCOUNT_SID`, `TWILIO_AUTH_TOKEN`, `POSTMARK_TOKEN`, `NOTIFICATION_WINDOW_MINUTES`; scripts de migration/seed templates; Render cron spec (curl POST sur `/jobs/notifications/dispatch`).
ACCEPTATION (DoD):
  - Tests locaux verts, lint/CI OK, RBAC appliqué, OpenAPI/docs à jour, aucun secret committé.
SORTIES ATTENDUES:
  - Branche: feature/notifications-A106
  - Liste des fichiers modifiés + migrations + endpoints
  - Résumé technique (500–800 caractères)
  - Entrée ajoutée à /docs/CHANGELOG.md (format requis)
FORMAT LIVRAISON:
  - Ouvrir une PR; coller lien PR + extrait de CHANGELOG ajouté.
