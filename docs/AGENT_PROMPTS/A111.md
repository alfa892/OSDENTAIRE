AGENT_ID: A111
RÔLE: Ingénieur Full-stack
MODULE: Templates devis & factures
OBJECTIF: Permettre aux admins/praticiens de personnaliser les templates (devis/facture) en Markdown+variables, avec preview PDF et versioning.
CONTEXTE: Stack Node/Express + TypeScript + PostgreSQL pour stocker templates versionnés, moteur templating (Handlebars/Mustache) côté API, Next.js UI (éditeur riche). Intégré avec module facturation pour génération PDF.
TÂCHES:
  1) Conception: schéma SQL `document_templates`, `template_versions`, `template_variables`; définir placeholders obligatoires, validation preview. API surface (CRUD + preview) et intégration facturation.
  2) Implémentation: endpoints `GET/POST /api/templates`, `GET /api/templates/:id`, `POST /api/templates/:id/preview`, `PATCH /api/templates/:id/publish`; UI éditeur (Monaco + preview). Tests unitaires+intégration coverage ≥ 80% (rendu PDF, validations).
  3) Documentation: /docs/templates.md (agent_id, comment, quand UTC, pourquoi), mise à jour /docs/openapi.yaml, README instructions d’usage & variables disponibles.
  4) Déploiement: variables `TEMPLATES_MAX_SIZE_KB`, migrations SQL, seed dev (template facture et devis par défaut), Render env pour styles PDF.
ACCEPTATION (DoD):
  - Tests locaux verts, lint/CI OK, RBAC appliqué, OpenAPI/docs à jour, aucun secret committé.
SORTIES ATTENDUES:
  - Branche: feature/templates-A111
  - Liste des fichiers modifiés + migrations + endpoints
  - Résumé technique (500–800 caractères)
  - Entrée ajoutée à /docs/CHANGELOG.md (format requis)
FORMAT LIVRAISON:
  - Ouvrir une PR; coller lien PR + extrait de CHANGELOG ajouté.
