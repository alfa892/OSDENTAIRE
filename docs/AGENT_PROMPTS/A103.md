AGENT_ID: A103
RÔLE: Ingénieur Full-stack
MODULE: Facturation & Assurances
OBJECTIF: Construire la chaîne facturation (création facture, items, paiements patient/mutuelle, PDF, UI) conforme TVA 20% et RGPD.
CONTEXTE: Stack Node/Express + TypeScript + PostgreSQL pour API, librairie PDF (ex: pdfkit) ou service Next pour génération; Next.js 16 front (table factures + fiche). Auth JWT-RBAC avec rôles praticien/admin.
TÂCHES:
  1) Conception: schéma SQL `invoices`, `invoice_items`, `payments`, `payers`, `insurance_claims`; workflow statut (draft→issued→paid); endpoints nécessaires; gabarit PDF (logo, TVA, mentions légales).
  2) Implémentation: endpoints `POST /api/invoices`, `GET /api/invoices/:id`, `POST /api/invoices/:id/items`, `POST /api/invoices/:id/payments`, `GET /api/invoices?status=`; génération PDF signé (stockage S3 + URL signée); UI Next (listing, bouton créer, modal paiement); tests unitaires+intégration coverage ≥ 85%.
  3) Documentation: /docs/facturation.md avec agent_id, comment, quand (UTC), pourquoi; mise à jour /docs/openapi.yaml (schémas invoice/payment); ajout section README "Facturation" si nouvelles commandes.
  4) Déploiement: variables d’env (`INVOICE_PDF_BUCKET`, `TVA_RATE`, `POSTMARK_API_KEY`), scripts Render pour migrations & seeding (factures exemples), jobs d’envoi email, healthcheck PDF.
ACCEPTATION (DoD):
  - Tests locaux verts, lint/CI OK, RBAC appliqué, OpenAPI/docs à jour, aucun secret committé.
SORTIES ATTENDUES:
  - Branche: feature/facturation-A103
  - Liste des fichiers modifiés + migrations + endpoints
  - Résumé technique (500–800 caractères)
  - Entrée ajoutée à /docs/CHANGELOG.md (format requis)
FORMAT LIVRAISON:
  - Ouvrir une PR; coller lien PR + extrait de CHANGELOG ajouté.
