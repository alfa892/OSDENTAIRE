AGENT_ID: A107
RÔLE: Ingénieur Full-stack
MODULE: Imagerie dentaire
OBJECTIF: Permettre l’upload sécurisé de radiographies/scans, stockage S3-compatible, visualisation côté praticien et conformité RGPD.
CONTEXTE: Stack Node/Express + TypeScript + PostgreSQL pour métadonnées, stockage objets (S3/Backblaze) via SDK, Next.js 16 UI (galerie, viewer). Auth RBAC (praticien accès complet, assistante upload lecture, admin audit). Chiffrement champs sensibles.
TÂCHES:
  1) Conception: schéma SQL `studies`, `images`, `image_tags`; workflow consentement patient; stratégie signed URL (PUT) + callback; limites taille/type.
  2) Implémentation: endpoints `POST /api/patients/:id/images/upload-url`, `POST /api/patients/:id/images`, `GET /api/patients/:id/images`, `DELETE /api/images/:id`; UI Next (galerie grille + viewer modale). Tests unitaires+intégration coverage ≥ 80% incluant mocks S3.
  3) Documentation: /docs/imagerie.md (agent_id, comment, quand UTC, pourquoi), mise à jour /docs/openapi.yaml (upload flow), README section "Imagerie" (prérequis bucket, rotation clés).
  4) Déploiement: variables `IMAGING_BUCKET`, `IMAGING_CDN_URL`, `MAX_IMAGE_MB`, migrations SQL, seed dev (images factices), Render secret pour clé bucket, job purge fichiers supprimés.
ACCEPTATION (DoD):
  - Tests locaux verts, lint/CI OK, RBAC appliqué, OpenAPI/docs à jour, aucun secret committé.
SORTIES ATTENDUES:
  - Branche: feature/imagerie-A107
  - Liste des fichiers modifiés + migrations + endpoints
  - Résumé technique (500–800 caractères)
  - Entrée ajoutée à /docs/CHANGELOG.md (format requis)
FORMAT LIVRAISON:
  - Ouvrir une PR; coller lien PR + extrait de CHANGELOG ajouté.
