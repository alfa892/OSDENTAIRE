AGENT_ID: A112
RÔLE: Ingénieur Backend
MODULE: Rôles & permissions avancés
OBJECTIF: Étendre le système RBAC en permissions fines (scopes), MFA obligatoire optionnelle, audit amélioré et outils de gestion (UI minimale si possible).
CONTEXTE: Stack Node/Express + TypeScript + PostgreSQL; authentification JWT existante à étendre; éventuellement Next.js composant admin léger. Conformité RGPD/audit obligatoire.
TÂCHES:
  1) Conception: schéma SQL `permissions`, `role_permissions`, `user_sessions`, `mfa_secrets`; mapping rôles→scopes, héritage, politiques par endpoint. Définir flows MFA (TOTP) et récupération.
  2) Implémentation: middleware RBAC réécrit pour lire scopes, endpoints `GET/POST /api/roles`, `POST /api/users/:id/permissions`, `POST /api/auth/mfa/setup`, `POST /api/auth/mfa/verify`; mise à jour tests existants pour vérifier enforcement; coverage ≥ 85%.
  3) Documentation: /docs/rbac.md (agent_id, comment, quand UTC, pourquoi), /docs/openapi.yaml (auth endpoints), guide sécurité README (MFA, rotation clés), mention DPA.
  4) Déploiement: variables `MFA_ISSUER`, `SESSION_TTL_MIN`, migrations SQL, seed dev (rôles par défaut), Render instructions pour secrets (TOTP seed), scripts pour purge sessions.
ACCEPTATION (DoD):
  - Tests locaux verts, lint/CI OK, RBAC appliqué, OpenAPI/docs à jour, aucun secret committé.
SORTIES ATTENDUES:
  - Branche: feature/rbac-advanced-A112
  - Liste des fichiers modifiés + migrations + endpoints
  - Résumé technique (500–800 caractères)
  - Entrée ajoutée à /docs/CHANGELOG.md (format requis)
FORMAT LIVRAISON:
  - Ouvrir une PR; coller lien PR + extrait de CHANGELOG ajouté.
